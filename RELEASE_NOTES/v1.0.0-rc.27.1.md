# Release v1.0.0-rc.27.1 - History Corruption Fix

## Overview
Fixes for the issuance history corruption caused by the cumulative correction bug in rc.18.3 (commit `fc9283e` from Dec 2, 09:42).

## Root Cause
The commit `fc9283e` attempted to fix issuance drops by adding cumulative corrections to all subsequent samples. This inflated 416 samples by ~4M TAO, creating synthetic data with constant +9,461.82 TAO deltas.

## Fixed
- **Above-chain sanitization**: Removes any samples with issuance > current chain value (impossible since issuance only increases)
- **Sanitization order**: Now runs BEFORE new sample validation (was validating against corrupt history)
- **Time-proportional delta**: Max allowed delta scales with time elapsed (handles gaps after cleanup)
- **Replace history option**: Added `REPLACE_ISSUANCE_HISTORY` workflow input to skip merge with corrupt KV data

## Technical Details

### Sanitization Strategy (3 passes)
1. **Bounds check**: Remove samples outside 10M-15M TAO range
2. **Above-chain check**: Remove samples > current chain issuance + 50 TAO tolerance
3. **Drop detection**: Remove sample BEFORE any drop (it was too high)

### Time-Proportional Delta Validation
```python
expected_emission_per_second = 7200.0 / 86400.0  # ~0.083 TAO/sec
max_delta = max(1000, expected_emission_per_second * time_elapsed * 2)
```
- Minimum 1000 TAO for normal intervals
- Scales to ~100k TAO for 7-day gaps (2x expected emission)

## Commits
- `75742e7` fix: Remove samples above current chain issuance
- `8b52cb5` fix: Add option to replace issuance_history without merge
- `7562d1d` fix: Make max delta proportional to time elapsed
